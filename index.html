<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Chat Message Anonim Only Hacker By Xrans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      font-weight: bold;
    }
    
    body {
      background-color: #121212;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    h1, h2, h3 {
      text-align: center;
      color: #ff4444;
      text-shadow: 0 0 5px #ff0000;
      margin: 10px 0;
    }
    
    #login-container, #chat-container, #group-container {
      padding: 20px;
      margin: 10px auto;
      width: 100%;
      max-width: 500px;
      background-color: #1e1e1e;
      border: 1px solid #ff4444;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
    }
    
    input, textarea {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #2a2a2a;
      color: #e0e0e0;
      font-weight: bold;
    }
    
    button {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      border: none;
      border-radius: 4px;
      background-color: #ff4444;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    button:hover {
      background-color: #ff0000;
      color: white;
      box-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
    }
    
    #chat-container, #group-container { 
      display: none; 
    }
    
    /* Bubble Chat Styles */
    #messages {
      padding: 10px;
      height: 400px;
      overflow-y: auto;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
      background-color: #1a1a1a;
      border: 1px solid #333;
      border-radius: 5px;
    }
    
    .message {
      max-width: 80%;
      margin-bottom: 15px;
      padding: 10px 15px;
      border-radius: 18px;
      position: relative;
      word-wrap: break-word;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message.you {
      align-self: flex-end;
      background-color: #2a2a2a;
      border: 1px solid #00ff00;
      border-bottom-right-radius: 0;
    }
    
    .message.other {
      align-self: flex-start;
      background-color: #2a2a2a;
      border: 1px solid #0088ff;
      border-bottom-left-radius: 0;
    }
    
    .message-info {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 5px;
    }
    
    .message.you .message-info {
      color: rgba(255,255,255,0.7);
    }
    
    .message.other .message-info {
      color: #888;
    }
    
    .message-sender {
      font-weight: bold;
    }
    
    .message-time {
      margin-left: 10px;
    }
    
    .message-type {
      position: absolute;
      top: -18px;
      font-size: 11px;
      color: #ff4444;
      left: 0;
      width: 100%;
      text-align: center;
    }
    
    .message.you .message-type {
      text-align: right;
      right: 10px;
      left: auto;
    }
    
    .message-content {
      color: #ffffff;
    }
    
    .message.you .message-content {
      color: #00ff00 !important;
    }
    
    .message.other .message-content {
      color: #0088ff !important;
    }
    
    .message-content img, .message-content video {
      max-width: 100%;
      border-radius: 5px;
      margin-top: 5px;
      border: 1px solid #444;
    }
    
    /* Input Area */
    #input-container {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 10px;
      background-color: #1e1e1e;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #333;
    }
    
    #input-row {
      display: flex;
      gap: 5px;
    }
    
    #chat-input {
      flex: 1;
      padding: 12px;
      background-color: #2a2a2a;
      color: #e0e0e0;
    }
    
    #btn-send {
      width: auto;
      padding: 12px 20px;
      background-color: #ff4444;
      color: black;
    }
    
    /* User List */
    #user-list-container {
      margin-top: 10px;
      background-color: #1e1e1e;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #333;
      display: none;
    }
    
    #user-list {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    #group-list {
      display: none;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    
    #user-list button, #group-users button, #group-list button {
      flex: 1;
      min-width: 100px;
      background-color: #2a2a2a;
      color: #ff4444;
      border: 1px solid #ff4444;
      padding: 8px;
      font-size: 14px;
    }
    
    #user-list button:hover, #group-users button:hover, #group-list button:hover {
      background-color: #ff4444;
      color: black;
    }
    
    .online::after { 
      content: " ●"; 
      color: #00ff00;
      text-shadow: 0 0 5px #00ff00;
    }
    
    .offline::after { 
      content: " ●"; 
      color: #888; 
    }
    
    .active-chat { 
      background-color: #3a0000 !important;
      border-color: #ff0000 !important;
    }
    
    /* Group Requests */
    #group-requests-box {
      margin-top: 20px;
      border: 1px solid #ff4444;
      padding: 10px;
      border-radius: 5px;
      display: none;
      background-color: #1e1e1e;
    }
    
    /* Scrollbar */
    #messages::-webkit-scrollbar {
      width: 8px;
    }
    
    #messages::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    
    #messages::-webkit-scrollbar-thumb {
      background: #ff4444;
      border-radius: 4px;
    }
    
    #messages::-webkit-scrollbar-thumb:hover {
      background: #ff0000;
    }
    
    /* Current Chat Info */
    #current-chat-info {
      background-color: #2a0000;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      text-align: center;
      border: 1px solid #ff4444;
      color: #ff8888;
    }
    
    /* File Input */
    #file-input {
      margin-top: 5px;
      background-color: #2a2a2a;
      padding: 8px;
      border-radius: 4px;
      color: #e0e0e0;
    }
    
    /* Search */
    #search-user {
      margin-bottom: 10px;
      background-color: #2a2a2a;
      color: #e0e0e0;
      border: 1px solid #444;
    }
    
    /* Toggle Buttons */
    #toggle-user-list, #toggle-group-btn {
      background-color: #2a0000;
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    #toggle-user-list:hover, #toggle-group-btn:hover {
      background-color: #ff4444;
      color: black;
    }
    
    /* Login Message */
    #login-msg {
      text-align: center;
      color: #ff4444;
      margin-top: 10px;
      text-shadow: 0 0 3px #ff0000;
    }
    
    /* Glow Effect */
    .glow {
      animation: glow 1.5s infinite alternate;
    }
    
    @keyframes glow {
      from {
        text-shadow: 0 0 5px #ff0000;
      }
      to {
        text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
      }
    }
  </style>
</head>
<body>
  <div id="login-container">
    <h1 class="glow">Chat Message Anonim Only Hacker By Xrans</h1>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button id="btn-register">Daftar</button>
    <button id="btn-login">Login</button>
    <p id="login-msg"></p>
  </div>

  <div id="chat-container">
    <h2 class="glow">Chat Message Anonim Only Hacker By Xrans</h2>
    <button id="toggle-user-list" onclick="toggleUserList()">Tampilkan Daftar Pengguna</button>
    <button id="toggle-group-btn" onclick="toggleGroupChat()">Tampilkan Daftar Grup</button>
    <div id="current-chat-info">Sedang chat dengan: SEMUA</div>
    
    <div id="user-list-container">
      <span style="color: #ff4444;">Daftar Pengguna</span>
      <div class="search-container">
        <input type="text" id="search-user" placeholder="Cari pengguna..." oninput="filterUsers()">
      </div>
      <div id="user-list"></div>
    </div>
    
    <div id="group-list"></div>
    <div id="messages"></div>
    
    <div id="input-container">
      <div id="input-row">
        <input id="chat-input" type="text" placeholder="Ketik pesan di sini...">
        <button id="btn-send">Kirim</button>
      </div>
      <input type="file" id="file-input">
    </div>
    
    <button onclick="switchToGroup()">Kelola Grup</button>
    <button onclick="toggleGroupRequests()">Lihat Permintaan Grup</button>
    <div id="group-requests-box"></div>
  </div>

  <div id="group-container">
    <div id="top-group-controls">
      <input id="group-name" placeholder="Nama Grup">
      <button id="btn-create-group">Buat Grup</button>
      <button onclick="switchToChat()">← Kembali ke Chat</button>
    </div>
    <div id="group-users"></div>
  </div>

  <script>
    const config = {
      apiKey: "AIzaSyA_QzbdScTX2dLdu_VchsPH1JL-1tn3RcI",
      authDomain: "chat-message-fcf6f.firebaseapp.com",
      databaseURL: "https://chat-message-fcf6f-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "chat-message-fcf6f",
      storageBucket: "chat-message-fcf6f.appspot.com",
      messagingSenderId: "137162503818",
      appId: "1:137162503818:web:2c782da021738705e99f73"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    let currentUser = null;
    let chatWith = "ALL";
    let showGroupChat = false;
    let showUserList = false;
    let currentChatType = "public";
    let allUsers = [];

    const loginBox = document.getElementById('login-container');
    const chatBox = document.getElementById('chat-container');
    const groupBox = document.getElementById('group-container');
    const msgBox = document.getElementById('login-msg');
    const userEl = document.getElementById('username');
    const passEl = document.getElementById('password');
    const msgArea = document.getElementById('messages');
    const userList = document.getElementById('user-list');
    const groupList = document.getElementById('group-list');
    const chatInput = document.getElementById('chat-input');
    const groupReqBox = document.getElementById('group-requests-box');
    const groupUsers = document.getElementById('group-users');
    const toggleGroupBtn = document.getElementById('toggle-group-btn');
    const toggleUserListBtn = document.getElementById('toggle-user-list');
    const currentChatInfo = document.getElementById('current-chat-info');
    const userListContainer = document.getElementById('user-list-container');
    const searchUserInput = document.getElementById('search-user');

    document.getElementById('btn-register').onclick = () => {
      const u = userEl.value, p = passEl.value;
      if (!u || !p) return msgBox.textContent = "Isi lengkap.";
      db.ref("users/" + u).get().then(snap => {
        if (snap.exists()) return msgBox.textContent = "Username sudah dipakai.";
        db.ref("users/" + u).set({ password: p, online: true });
        msgBox.textContent = "Berhasil daftar, login sekarang.";
      });
    };

    document.getElementById('btn-login').onclick = () => {
      const u = userEl.value, p = passEl.value;
      db.ref("users/" + u).get().then(snap => {
        if (!snap.exists() || snap.val().password !== p) {
          msgBox.textContent = "Login gagal.";
        } else {
          currentUser = u;
          db.ref("users/" + u).update({ online: true });
          loginBox.style.display = "none";
          chatBox.style.display = "block";
          initChat();
        }
      });
    };

    function initChat() {
      db.ref("users").on("value", snap => {
        userList.innerHTML = '';
        groupUsers.innerHTML = '';
        allUsers = [];
        
        const publicBtn = document.createElement('button');
        publicBtn.textContent = "SEMUA";
        publicBtn.className = chatWith === "ALL" ? "active-chat" : "";
        publicBtn.onclick = () => {
          chatWith = "ALL";
          currentChatType = "public";
          updateChatInfo();
          msgArea.innerHTML = '';
          loadMessages();
        };
        userList.appendChild(publicBtn);
        
        snap.forEach(child => {
          const u = child.key;
          if (u === currentUser) return;
          allUsers.push(u);
          const status = child.val().online ? 'online' : 'offline';
          
          const btn = document.createElement('button');
          btn.textContent = u;
          btn.className = status + (chatWith === u ? " active-chat" : "");
          btn.onclick = () => {
            chatWith = u;
            currentChatType = "private";
            updateChatInfo();
            msgArea.innerHTML = '';
            loadPrivateMessages(currentUser, u);
          };
          userList.appendChild(btn);

          const inviteBtn = document.createElement('button');
          inviteBtn.textContent = `Undang ${u}`;
          inviteBtn.onclick = () => inviteToGroup(u);
          groupUsers.appendChild(inviteBtn);
        });
      });

      db.ref("groups").on("value", snap => {
        groupList.innerHTML = '';
        snap.forEach(child => {
          const groupName = child.key;
          if (child.val().members && child.val().members[currentUser]) {
            const btn = document.createElement('button');
            btn.textContent = groupName;
            btn.className = chatWith === "GROUP_"+groupName ? "active-chat" : "";
            btn.onclick = () => {
              chatWith = "GROUP_"+groupName;
              currentChatType = "group";
              updateChatInfo();
              msgArea.innerHTML = '';
              loadGroupMessages(groupName);
            };
            groupList.appendChild(btn);
          }
        });
      });

      // Listen for new public messages
      db.ref("public_messages").orderByChild("timestamp").on("child_added", s => {
        if (currentChatType === "public") {
          showMessage(s.val());
        }
      });

      // Listen for new private messages
      db.ref("private_messages").orderByChild("timestamp").on("child_added", s => {
        const msg = s.val();
        if (currentChatType === "private" && 
            ((msg.from === currentUser && msg.to === chatWith) || 
             (msg.from === chatWith && msg.to === currentUser))) {
          showMessage(msg);
        }
      });

      // Listen for new group messages
      db.ref("group_messages").on("child_added", s => {
        if (currentChatType === "group" && s.key === chatWith.substring(6)) {
          s.forEach(child => {
            if (currentChatType === "group") {
              showMessage(child.val());
            }
          });
        }
      });

      db.ref("group_requests/" + currentUser).on("child_added", s => {
        const groupName = s.key;
        const div = document.createElement('div');
        div.innerHTML = `Undangan ke grup <b style="color:#ff4444">${groupName}</b> 
          <button onclick="acceptGroup('${groupName}')">Gabung</button>`;
        groupReqBox.appendChild(div);
      });
      
      updateChatInfo();
      
      chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      document.querySelector('.search-container').addEventListener('click', function(e) {
        if (e.target.tagName === 'DIV' || e.target.classList.contains('search-container')) {
          searchUserInput.value = '';
          filterUsers();
        }
      });
    }

    function loadMessages() {
      msgArea.innerHTML = '';
      if (currentChatType === "public") {
        loadPublicMessages();
      }
    }

    function loadPublicMessages() {
      db.ref("public_messages").orderByChild("timestamp").once("value", snap => {
        snap.forEach(child => {
          showMessage(child.val());
        });
      });
    }

    function loadPrivateMessages(user1, user2) {
      const conversationId = [user1, user2].sort().join('_');
      
      db.ref("private_messages")
        .orderByChild("conversationId")
        .equalTo(conversationId)
        .once("value", snap => {
          snap.forEach(child => {
            showMessage(child.val());
          });
        });
    }

    function loadGroupMessages(groupName) {
      db.ref("group_messages/" + groupName).orderByChild("timestamp").once("value", snap => {
        snap.forEach(child => {
          showMessage(child.val());
        });
      });
    }

    function filterUsers() {
      const searchTerm = searchUserInput.value.toLowerCase();
      const userButtons = userList.getElementsByTagName('button');
      
      for (let i = 0; i < userButtons.length; i++) {
        const username = userButtons[i].textContent.toLowerCase();
        if (username.includes(searchTerm) || userButtons[i].textContent === "SEMUA") {
          userButtons[i].style.display = "block";
        } else {
          userButtons[i].style.display = "none";
        }
      }
    }

    function toggleUserList() {
      showUserList = !showUserList;
      userListContainer.style.display = showUserList ? 'block' : 'none';
      toggleUserListBtn.textContent = showUserList ? "✔️ Sembunyikan" : "✖️ Tampilkan";
      if (showUserList) {
        searchUserInput.value = '';
        filterUsers();
      }
    }

    function toggleGroupChat() {
      showGroupChat = !showGroupChat;
      groupList.style.display = showGroupChat ? "flex" : "none";
      toggleGroupBtn.textContent = showGroupChat ? "Sembunyikan Daftar Grup" : "Tampilkan Daftar Grup";
    }

    function updateChatInfo() {
      let chatName = chatWith;
      if (chatWith === "ALL") chatName = "SEMUA";
      else if (chatWith.startsWith("GROUP_")) chatName = chatWith.substring(6);
      
      currentChatInfo.textContent = `Sedang chat dengan: ${chatName}`;
      
      document.querySelectorAll('#user-list button, #group-list button').forEach(btn => {
        btn.classList.remove('active-chat');
      });
      
      if (chatWith === "ALL") {
        document.querySelector('#user-list button:first-child').classList.add('active-chat');
      } else if (chatWith.startsWith("GROUP_")) {
        const groupName = chatWith.substring(6);
        document.querySelectorAll('#group-list button').forEach(btn => {
          if (btn.textContent === groupName) {
            btn.classList.add('active-chat');
          }
        });
      } else {
        document.querySelectorAll('#user-list button').forEach(btn => {
          if (btn.textContent === chatWith) {
            btn.classList.add('active-chat');
          }
        });
      }
    }

    document.getElementById('btn-send').onclick = sendMessage;

    function sendMessage() {
      const text = chatInput.value.trim();
      if (!text) return;
      
      const timestamp = Date.now();
      
      if (currentChatType === "public") {
        const messageData = { 
          from: currentUser,
          text: text,
          type: "public",
          timestamp: timestamp
        };
        
        db.ref("public_messages").push(messageData)
          .then(() => {
            chatInput.value = '';
            chatInput.focus();
          });
      }
      else if (currentChatType === "private") {
        const conversationId = [currentUser, chatWith].sort().join('_');
        
        const messageData = { 
          from: currentUser,
          to: chatWith,
          text: text,
          type: "private",
          timestamp: timestamp,
          conversationId: conversationId
        };
        
        db.ref("private_messages").push(messageData)
          .then(() => {
            chatInput.value = '';
            chatInput.focus();
          });
      }
      else if (currentChatType === "group") {
        const groupName = chatWith.substring(6);
        const messageData = { 
          from: currentUser,
          text: text,
          type: "group",
          groupName: groupName,
          timestamp: timestamp
        };
        
        db.ref("group_messages/" + groupName).push(messageData)
          .then(() => {
            chatInput.value = '';
            chatInput.focus();
          });
      }
    }

    document.getElementById('file-input').onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        let content = file.type.startsWith('image') ? `<img src="${reader.result}" width="150">`
                  : file.type.startsWith('video') ? `<video controls width="150"><source src="${reader.result}"></video>`
                  : '';
        
        const timestamp = Date.now();
        
        if (currentChatType === "public") {
          const messageData = { 
            from: currentUser,
            text: content,
            type: "public",
            timestamp: timestamp
          };
          db.ref("public_messages").push(messageData);
        }
        else if (currentChatType === "private") {
          const conversationId = [currentUser, chatWith].sort().join('_');
          const messageData = { 
            from: currentUser,
            to: chatWith,
            text: content,
            type: "private",
            timestamp: timestamp,
            conversationId: conversationId
          };
          db.ref("private_messages").push(messageData);
        }
        else if (currentChatType === "group") {
          const groupName = chatWith.substring(6);
          const messageData = { 
            from: currentUser,
            text: content,
            type: "group",
            groupName: groupName,
            timestamp: timestamp
          };
          db.ref("group_messages/" + groupName).push(messageData);
        }
      };
      reader.readAsDataURL(file);
    };

    function showMessage({from, type, text, timestamp}) {
      const d = new Date(timestamp);
      const time = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${from === currentUser ? "you" : "other"}`;
      
      const typeSpan = document.createElement('span');
      typeSpan.className = 'message-type';
      if (type === "public") typeSpan.textContent = "PUBLIK";
      else if (type === "group") typeSpan.textContent = "GRUP";
      else if (type === "private") typeSpan.textContent = "PRIVAT";
      typeSpan.style.color = "#ff4444";
      
      const infoDiv = document.createElement('div');
      infoDiv.className = 'message-info';
      
      const senderSpan = document.createElement('span');
      senderSpan.className = 'message-sender';
      senderSpan.textContent = from;
      if (from === currentUser) {
        senderSpan.style.color = "#00ff00";
      } else {
        senderSpan.style.color = "#0088ff";
      }
      
      const timeSpan = document.createElement('span');
      timeSpan.className = 'message-time';
      timeSpan.textContent = time;
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.innerHTML = text;
      
      infoDiv.appendChild(senderSpan);
      infoDiv.appendChild(timeSpan);
      
      messageDiv.appendChild(typeSpan);
      messageDiv.appendChild(infoDiv);
      messageDiv.appendChild(contentDiv);
      
      msgArea.appendChild(messageDiv);
      msgArea.scrollTop = msgArea.scrollHeight;
    }

    function acceptGroup(group) {
      db.ref("groups/" + group + "/members/" + currentUser).set(true);
      db.ref("group_requests/" + currentUser + "/" + group).remove();
      alert("Bergabung ke grup " + group);
    }

    function inviteToGroup(user) {
      const group = document.getElementById('group-name').value;
      if (!group) return alert("Masukkan nama grup dulu.");
      db.ref("group_requests/" + user + "/" + group).set({ from: currentUser });
      alert("Undangan dikirim.");
    }

    document.getElementById('btn-create-group').onclick = () => {
      const name = document.getElementById('group-name').value;
      if (!name) return;
      db.ref("groups/" + name).set({ 
        admin: currentUser, 
        members: { [currentUser]: true } 
      });
      alert("Grup dibuat.");
    };

    function switchToGroup() {
      chatBox.style.display = "none";
      groupBox.style.display = "block";
    }

    function switchToChat() {
      chatBox.style.display = "block";
      groupBox.style.display = "none";
    }

    function toggleGroupRequests() {
      groupReqBox.style.display = groupReqBox.style.display === 'none' ? 'block' : 'none';
    }

    window.addEventListener('beforeunload', () => {
      if (currentUser) {
        db.ref("users/" + currentUser).update({ online: false });
      }
    });
  </script>
</body>
</html>
